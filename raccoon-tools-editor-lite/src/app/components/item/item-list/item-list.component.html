<div class="item-list-container">
  <header class="item-list-header">
    <h2>Items</h2>
    <div class="header-actions">
      <button class="add-btn" (click)="addNewItem()">+ Add Item</button>
      <label class="import-btn">
        <input type="file" accept=".json" (change)="onFileSelected($event)" hidden />
        Import JSON
      </label>
      <button class="export-btn" (click)="exportItems()">Export JSON</button>
    </div>
  </header>

  <div class="item-list-content">
    @if ((items$ | async)?.length === 0) {
      <p class="empty-message">No items loaded.</p>
    }
    
    @if ((items$ | async)?.length) {
      <table class="items-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Item Type</th>
            <th>Change Value</th>
            <th>Use Count</th>
            <th>Parent Entity</th>
            <th>Target Entity</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (item of items$ | async; track item.ID) {
            <tr [class.editing]="isEditing(item.ID)">
              @if (!isEditing(item.ID)) {
                <td>{{ item.ID }}</td>
                <td>{{ item.Name }}</td>
                <td>{{ item.Description }}</td>
                <td>{{ getItemTypeName(item.ItemType) }}</td>
                <td>{{ item.ChangeValue }}</td>
                <td>{{ item.UseCount }}</td>
                <td>{{ item.ParentEntity }}</td>
                <td>{{ item.TargetEntity }}</td>
                <td class="actions-cell">
                  <button class="edit-btn" (click)="startEditing(item)">Edit</button>
                  <button class="delete-btn" (click)="deleteItemById(item.ID)">Delete</button>
                </td>
              }
              
              @if (isEditing(item.ID) && editingItem) {
                <td>{{ editingItem.ID }}</td>
                <td><input type="text" [(ngModel)]="editingItem.Name" class="edit-input" /></td>
                <td><input type="text" [(ngModel)]="editingItem.Description" class="edit-input" /></td>
                <td>
                  <select [(ngModel)]="editingItem.ItemType" class="edit-input">
                    @for (opt of itemTypeOptions; track opt.value) {
                      <option [ngValue]="opt.value">{{ opt.label }}</option>
                    }
                  </select>
                </td>
                <td><input type="number" [(ngModel)]="editingItem.ChangeValue" class="edit-input" /></td>
                <td><input type="number" [(ngModel)]="editingItem.UseCount" class="edit-input" /></td>
                <td><input type="number" [(ngModel)]="editingItem.ParentEntity" class="edit-input" /></td>
                <td><input type="number" [(ngModel)]="editingItem.TargetEntity" class="edit-input" /></td>
                <td class="actions-cell">
                  <button class="save-btn" (click)="saveItem()">Save</button>
                  <button class="cancel-btn" (click)="cancelEditing()">Cancel</button>
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    }
  </div>
</div>
